<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title>swagio</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.5.0/Chart.bundle.min.js"></script>
  <style>
    body,
    html {
      width: 100%;
      height: 100%;
      padding: 0;
      margin: 0;
    }

    #barChart {
      width: 100%;
      height: 100%;
    }
  </style>
</head>

<body>
  <canvas id="barChart"></canvas>
  <script>
    var data = {
      labels: [],
      datasets: [{
        label: 'Pin value ([0.0-1.0])',
        data: [],
        borderWidth: 1,
        backgroundColor: "rgba(75,192,192,0.4)",
        borderColor: "rgba(75,192,192,1)"
      }]
    }
    var ctx = document.getElementById("barChart")
    var barChart = new Chart(ctx, {
      type: 'bar',
      data: data,
      options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
          yAxes: [{
            ticks: {
              beginAtZero: true,
              suggestedMax: 1.0
            }
          }]
        }
      }
    })

    var ws = new WebSocket("ws://localhost:53491")
    ws.onmessage = function(event) {
      let pinData = JSON.parse(event.data)
      let pinNames = Object.keys(pinData)
      let pinValues = Object.values(pinData)

      barChart.config.data.labels = pinNames
      barChart.config.data.datasets[0].data = pinValues

      barChart.config.data.datasets[0].backgroundColor =
        pinNames.map(pin => (pin.charAt(0) == "D") ? 'rgba(127, 50, 67, 0.2)' : 'rgba(50, 67, 127, 0.2)')
      barChart.config.data.datasets[0].borderColor =
        pinNames.map(pin => (pin.charAt(0) == "D") ? 'rgba(127, 50, 67, 0.2)' : 'rgba(50, 67, 127, 0.2)')

      barChart.update()
    }
  </script>
</body>

</html>
